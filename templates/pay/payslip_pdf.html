{% load humanize %}
{% load mathfilters %}
{% load custom_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Payslip</title>
  <style>
    @page {
      size: A4;
      margin: 18mm 14mm 16mm;
    }

    body {
      font-family: "Helvetica", "Arial", sans-serif;
      font-size: 11px;
      color: #1f2937;
      margin: 0;
    }

    .header {
      border-bottom: 2px solid #0f172a;
      padding-bottom: 10px;
      margin-bottom: 14px;
    }

    .title {
      font-size: 21px;
      font-weight: 700;
      color: #0f172a;
      margin: 0;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 11px;
      color: #475569;
      margin: 2px 0 0;
    }

    .meta {
      margin-top: 8px;
      font-size: 10px;
      color: #475569;
    }

    .meta span {
      margin-right: 12px;
    }

    .section-title {
      font-size: 11px;
      font-weight: 700;
      color: #0f172a;
      margin: 12px 0 6px;
      text-transform: uppercase;
      letter-spacing: 0.05;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }

    .info-table td {
      border: 1px solid #cbd5e1;
      padding: 6px 8px;
      vertical-align: top;
    }

    .label {
      color: #64748b;
      width: 34%;
    }

    .value {
      color: #0f172a;
      text-align: right;
      font-weight: 600;
    }

    .grid {
      width: 100%;
    }

    .col {
      width: 49%;
      display: inline-block;
      vertical-align: top;
    }

    .col.right {
      margin-left: 1%;
    }

    .money-table th,
    .money-table td {
      border: 1px solid #cbd5e1;
      padding: 6px 8px;
    }

    .money-table th {
      text-align: left;
      background: #f1f5f9;
      color: #0f172a;
      font-weight: 700;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.03;
    }

    .money {
      text-align: right;
      font-weight: 600;
      color: #0f172a;
      white-space: nowrap;
    }

    .total-row td {
      background: #f8fafc;
      font-weight: 700;
    }

    .net-block {
      margin-top: 8px;
      border: 2px solid #0f172a;
    }

    .net-block td {
      padding: 8px 10px;
      border: 1px solid #0f172a;
    }

    .net-label {
      font-size: 12px;
      font-weight: 700;
      color: #0f172a;
    }

    .net-value {
      text-align: right;
      font-size: 16px;
      font-weight: 700;
      color: #0f172a;
    }

    .words {
      margin-top: 8px;
      background: #f8fafc;
      border: 1px solid #cbd5e1;
      padding: 8px 10px;
      font-size: 10px;
      color: #334155;
    }

    .signatures {
      margin-top: 26px;
    }

    .signature {
      width: 48%;
      display: inline-block;
      text-align: center;
      color: #334155;
      font-size: 10px;
    }

    .line {
      border-top: 1px solid #334155;
      margin: 0 auto 5px;
      width: 85%;
      height: 1px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 class="title">Payslip</h1>
    <p class="subtitle">Professional Payroll Statement</p>
    <div class="meta">
      <span><strong>Reference:</strong> PSL-{{ payroll.id }}</span>
      <span><strong>Period:</strong>
        {% with run=payroll.payroll_run_entries.first %}
          {% if run %}{{ run.payroll_run.paydays|date:"F Y" }}{% else %}N/A{% endif %}
        {% endwith %}
      </span>
    </div>
  </div>

  <p class="section-title">Employee Information</p>
  <table class="info-table">
    <tr>
      <td class="label">Employee ID</td>
      <td class="value">{{ payroll.pays.emp_id|default:"N/A" }}</td>
      <td class="label">Employee Name</td>
      <td class="value">{{ payroll.pays.first_name }} {{ payroll.pays.last_name }}</td>
    </tr>
    <tr>
      <td class="label">Tax ID (TIN)</td>
      <td class="value">{{ payroll.pays.tin_no|default:"N/A" }}</td>
      <td class="label">Designation</td>
      <td class="value">{{ payroll.pays.get_job_title_display|default:"N/A" }}</td>
    </tr>
    <tr>
      <td class="label">Bank</td>
      <td class="value">{{ payroll.pays.get_bank_display|default:"N/A" }}</td>
      <td class="label">Account Number</td>
      <td class="value">{{ payroll.pays.bank_account_number|mask_account_number|default:"N/A" }}</td>
    </tr>
  </table>

  <div class="grid">
    <div class="col">
      <p class="section-title">Earnings</p>
      <table class="money-table">
        <thead>
          <tr>
            <th>Description</th>
            <th class="money">Amount (NGN)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Basic Salary</td>
            <td class="money">{{ payroll.pays.employee_pay.basic|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Transport</td>
            <td class="money">{{ payroll.pays.employee_pay.transport|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Housing</td>
            <td class="money">{{ payroll.pays.employee_pay.housing|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Other Allowances</td>
            <td class="money">{{ payroll.calc_allowance|floatformat:2|intcomma }}</td>
          </tr>
          <tr class="total-row">
            <td>Gross for Period</td>
            <td class="money">{{ payroll.pays.employee_pay.gross_income|div:12|floatformat:2|intcomma }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="col right">
      <p class="section-title">Deductions</p>
      <table class="money-table">
        <thead>
          <tr>
            <th>Description</th>
            <th class="money">Amount (NGN)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Employee Pension</td>
            <td class="money">{{ payroll.pays.employee_pay.pension_employee|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>NHF</td>
            <td class="money">{{ payroll.pays.employee_pay.nhf|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Health Insurance</td>
            <td class="money">{{ payroll.pays.employee_pay.employee_health|div:12|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>PAYE Tax</td>
            <td class="money">{{ payroll.pays.employee_pay.payee|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Water Rate</td>
            <td class="money">{{ payroll.pays.employee_pay.water_rate|floatformat:2|intcomma }}</td>
          </tr>
          <tr>
            <td>Other Deductions</td>
            <td class="money">{{ payroll.calc_deduction|floatformat:2|intcomma }}</td>
          </tr>
          <tr class="total-row">
            <td>Total Deductions</td>
            {% with pension_monthly=payroll.pays.employee_pay.pension_employee|div:12 nhf_monthly=payroll.pays.employee_pay.nhf|div:12 health_monthly=payroll.pays.employee_pay.employee_health|div:12 %}
            <td class="money">{{ pension_monthly|add:nhf_monthly|add:health_monthly|add:payroll.pays.employee_pay.payee|add:payroll.pays.employee_pay.water_rate|add:payroll.calc_deduction|floatformat:2|intcomma }}</td>
            {% endwith %}
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <table class="net-block">
    <tr>
      <td class="net-label">Net Pay</td>
      <td class="net-value">â‚¦{{ payroll.netpay|floatformat:2|intcomma }}</td>
    </tr>
  </table>

  {% if num2words %}
  <div class="words">
    <strong>Amount in words:</strong> {{ num2words }}.
  </div>
  {% endif %}

  <div class="signatures">
    <div class="signature">
      <div class="line"></div>
      Employee Signature
    </div>
    <div class="signature">
      <div class="line"></div>
      Authorized Signatory
    </div>
  </div>
</body>
</html>
